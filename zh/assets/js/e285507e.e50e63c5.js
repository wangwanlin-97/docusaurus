"use strict";(self.webpackChunkwechaty_docusaurus=self.webpackChunkwechaty_docusaurus||[]).push([[3581],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),m=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=m(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=m(n),h=i,d=c["".concat(l,".").concat(h)]||c[h]||p[h]||r;return n?a.createElement(d,o(o({ref:t},u),{},{components:n})):a.createElement(d,o({ref:t},u))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var m=2;m<r;m++)o[m]=n[m];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},89377:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>m});var a=n(87462),i=(n(67294),n(3905));const r={title:"Create pull requests"},o=void 0,s={unversionedId:"contributing/pulls",id:"contributing/pulls",title:"Create pull requests",description:"This section is addressed to the committers and to anyone interested in knowing",source:"@site/docs/contributing/pulls.md",sourceDirName:"contributing",slug:"/contributing/pulls",permalink:"/zh/docs/contributing/pulls",draft:!1,editUrl:"https://github.com/wechaty/docusaurus/edit/main/docusaurus/docs/contributing/pulls.md",tags:[],version:"current",lastUpdatedBy:"Rajiv Singh",lastUpdatedAt:1631987027,formattedLastUpdatedAt:"2021\u5e749\u670818\u65e5",frontMatter:{title:"Create pull requests"},sidebar:"docs",previous:{title:"DevOps with CI/CD",permalink:"/zh/docs/contributing/devops"},next:{title:"Publish blog",permalink:"/zh/docs/contributing/blog"}},l={},m=[{value:"Handling pull requests",id:"handling-pull-requests",level:2},{value:"Committing guidelines",id:"committing-guidelines",level:2},{value:"Reverting commits",id:"reverting-commits",level:2},{value:"Special Thanks",id:"special-thanks",level:2}],u={toc:m},c="wrapper";function p(e){let{components:t,...n}=e;return(0,i.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This section is addressed to the committers and to anyone interested in knowing\nhow code gets committed into Wechaty. If you're a community member who wants to\ncontribute code to Wechaty, look at ",(0,i.kt)("a",{parentName:"p",href:"/zh/docs/contributing/git"},"working with git")," instead."),(0,i.kt)("h2",{id:"handling-pull-requests"},"Handling pull requests"),(0,i.kt)("p",null,"Since Wechaty is hosted on GitHub, patches are provided in the form of pull\nrequests."),(0,i.kt)("p",null,"When committing a pull request, make sure each individual commit matches the\ncommit guidelines described below. Contributors are expected to provide the\nbest pull requests possible. In practice however, committers - who will likely\nbe more familiar with the commit guidelines - may decide to bring a commit up\nto standard themselves."),(0,i.kt)("p",null,"If you find yourself checking out pull requests locally more often, this git\nalias will be helpful:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'[alias]\n    pr = !sh -c \\"git fetch upstream pull/${1}/head:pr/${1} && git checkout pr/${1}\\"\n')),(0,i.kt)("p",null,"Add it to your ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.gitconfig"),", and set ",(0,i.kt)("inlineCode",{parentName:"p"},"upstream")," to be ",(0,i.kt)("inlineCode",{parentName:"p"},"wechaty/wechaty"),".\nThen you can run ",(0,i.kt)("inlineCode",{parentName:"p"},"git pr ####")," to checkout the corresponding pull request."),(0,i.kt)("p",null,"At this point, you can work on the code. Use ",(0,i.kt)("inlineCode",{parentName:"p"},"git rebase -i")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"git commit --amend")," to make sure the commits have the expected level of quality.\nOnce you're ready:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'# Pull in the latest changes from main.\ngit checkout main\ngit pull upstream main\n# Rebase the pull request on main.\ngit checkout pr/####\ngit rebase main\ngit checkout main\n# Merge the work as "fast-forward" to main to avoid a merge commit.\n# (in practice, you can omit "--ff-only" since you just rebased)\ngit merge --ff-only pr/XXXX\n# If you\'re not sure if you did things correctly, check that only the\n# changes you expect will be pushed to upstream.\ngit push --dry-run upstream main\n# Push!\ngit push upstream main\n# Delete the pull request branch.\ngit branch -d pr/xxxx\n')),(0,i.kt)("p",null,"Force push to the branch after rebasing on main but before merging and pushing\nto upstream. This allows the commit hashes on main and the branch to match\nwhich automatically closes the pull request."),(0,i.kt)("p",null,"If a pull request doesn't need to be merged as multiple commits, you can use\nGitHub's \"Squash and merge\" button on the website. Edit the commit message as\nneeded and remove\nthe pull request number that's automatically appended to the message's first\nline."),(0,i.kt)("p",null,"When rewriting the commit history of a pull request, the goal is to make\nWechaty's commit history as usable as possible:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If a patch contains back-and-forth commits, then rewrite those into one.\nFor example, if a commit adds some code and a second commit fixes stylistic\nissues introduced in the first commit, those commits should be squashed\nbefore merging.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Separate changes to different commits by logical grouping: if you do a\nstylistic cleanup at the same time as you do other changes to a file,\nseparating the changes into two different commits will make reviewing\nhistory easier.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Beware of merges of upstream branches in the pull requests.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Tests should pass and docs should build after each commit. Neither the\ntests nor the docs should emit warnings.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Trivial and small patches usually are best done in one commit. Medium to\nlarge work may be split into multiple commits if it makes sense."))),(0,i.kt)("p",null,"Practicality beats purity, so it is up to each committer to decide how much\nhistory mangling to do for a pull request. The main points are engaging the\ncommunity, getting work done, and having a usable commit history."),(0,i.kt)("h2",{id:"committing-guidelines"},"Committing guidelines"),(0,i.kt)("p",null,"In addition, please follow the following guidelines when committing code to\nWechaty's Git repository:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Never change the published history of ",(0,i.kt)("inlineCode",{parentName:"p"},"wechaty/wechaty")," branches by force\npushing. If you absolutely must (for security reasons for example), first\ndiscuss the situation with the team.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'For any medium-to-big changes, where "medium-to-big" is according to\nyour judgment, please bring things up on the ',(0,i.kt)("em",{parentName:"p"},"wechaty"),"\nmailing list before making the change."),(0,i.kt)("p",{parentName:"li"},"If you bring something up on ",(0,i.kt)("em",{parentName:"p"},"wechaty")," mailist and nobody responds,\nplease don't take that to mean your idea is great and should be\nimplemented immediately because nobody contested it. Everyone doesn't always\nhave a lot of time to read mailing list discussions immediately, so you may\nhave to wait a couple of days before getting a response.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Write detailed commit messages in the past tense, not present tense."),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'Good: "Fixed Unicode bug in RSS API."'),(0,i.kt)("li",{parentName:"ul"},'Bad: "Fixes Unicode bug in RSS API."'),(0,i.kt)("li",{parentName:"ul"},'Bad: "Fixing Unicode bug in RSS API."')),(0,i.kt)("p",{parentName:"li"},"The commit message should be in lines of 72 chars maximum. There should be\na subject line, separated by a blank line and then paragraphs of 72 char\nlines. The limits are soft. For the subject line, shorter is better. In the\nbody of the commit message more detail is better than less:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-text"},"Fixed #18307 -- Added git workflow guidelines.\n\nRefactored the Wechaty's documentation to remove mentions of SVN\nspecific tasks. Added guidelines of how to use Git, GitHub, and\nhow to use pull request together with Trac instead.\n")),(0,i.kt)("p",{parentName:"li"},'Credit the contributors in the commit message: "Thanks A for the report and B\nfor review." Use git\'s ',(0,i.kt)("a",{parentName:"p",href:"https://help.github.com/articles/creating-a-commit-with-multiple-authors/"},"Co-Authored-By")," as appropriate.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'For commits to a branch, prefix the commit message with the branch name.\nFor example: "',"[1.4.x]",' Fixed #xxxxx -- Added support for mind reading."')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Limit commits to the most granular change that makes sense. This means,\nuse frequent small commits rather than infrequent large commits. For\nexample, if implementing feature X requires a small change to library Y,\nfirst commit the change to library Y, then commit feature X in a separate\ncommit. This goes a ",(0,i.kt)("em",{parentName:"p"},"long")," way- in helping everyone follow your changes.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Separate bug fixes from feature changes. Bugfixes may need to be backported\nto the stable branch, according to ",(0,i.kt)("strong",{parentName:"p"},"to-be-added"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If your commit closes an issue in the Wechaty ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wechaty/wechaty/issues"},"issues"),',\nbegin your commit message with the text "Fixed #xxxxx", where "xxxxx" is the\nnumber of the issue your commit fixes. Example: "Fixed #123 -- Added\nwhizbang feature.". Any commit message in that format will automatically\nclose the referenced issue and post a comment\nto it with the full commit message.'))),(0,i.kt)("h2",{id:"reverting-commits"},"Reverting commits"),(0,i.kt)("p",null,"Nobody's perfect; mistakes will be committed."),(0,i.kt)("p",null,"But try very hard to ensure that mistakes don't happen. Just because we have a\nreversion policy doesn't relax your responsibility to aim for the highest\nquality possible. Really: double-check your work, or have it checked by\nanother committer, ",(0,i.kt)("strong",{parentName:"p"},"before")," you commit it in the first place!"),(0,i.kt)("p",null,"When a mistaken commit is discovered, please follow these guidelines:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If possible, have the original author revert their own commit.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Don't revert another author's changes without permission from the\noriginal author.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Use git revert -- this will make a reverse commit, but the original\ncommit will still be part of the commit history.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If the original author can't be reached (within a reasonable amount\nof time -- a day or so) and the problem is severe -- crashing bug,\nmajor test failures, etc. -- then ask for objections on the\n",(0,i.kt)("em",{parentName:"p"},"wechaty")," mailing list then revert if there are none.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If the problem is small (a feature commit after feature freeze,\nsay), wait it out.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If there's a disagreement between the committer and the\nreverter-to-be then try to work it out on the ",(0,i.kt)("em",{parentName:"p"},"wechaty"),"\nmailing list. If an agreement can't be reached then it should\nbe put to a vote.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If the commit introduced a confirmed, disclosed security\nvulnerability then the commit may be reverted immediately without\npermission from anyone.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The release branch maintainer may back out commits to the release\nbranch without permission if the commit breaks the release branch.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If you mistakenly push a topic branch to ",(0,i.kt)("inlineCode",{parentName:"p"},"wechaty/wechaty"),", delete it.\nFor instance, if you did: ",(0,i.kt)("inlineCode",{parentName:"p"},"git push upstream feature_antigravity"),",\ndo a reverse push: ",(0,i.kt)("inlineCode",{parentName:"p"},"git push upstream :feature_antigravity"),"."))),(0,i.kt)("h2",{id:"special-thanks"},"Special Thanks"),(0,i.kt)("p",null,"I have to credit Django doc authors, because this documentation page is inspired by, and mostly copy/pasted from ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/django/django/blob/main/docs/internals/contributing/committing-code.txt"},"Django contributing docs")))}p.isMDXComponent=!0}}]);